
// Tag 7
#region Inputs
using System.Net.WebSockets;
using System.Runtime.Intrinsics.Arm;

string TestInput=@".......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............";
string PuzzleInput =@"......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^...^.^...................................................................
.............................................................................................................................................
..................................................................^.^.....^..................................................................
.............................................................................................................................................
.................................................................^...^.^.^.^.................................................................
.............................................................................................................................................
................................................................^...^.^.....^................................................................
.............................................................................................................................................
...............................................................^.^.^.^...^...^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.^.^.^.^..............................................................
.............................................................................................................................................
.............................................................^.....^.^.^.^.^...^.............................................................
.............................................................................................................................................
............................................................^.^.^...^.....^.^...^............................................................
.............................................................................................................................................
...........................................................^.^.^.^.^.^.^.^.^.^.^.^...........................................................
.............................................................................................................................................
..........................................................^...^...^...^.^.^.^...^.^..........................................................
.............................................................................................................................................
.........................................................^.^...^...^.^.^.^...^...^.^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^...^.^...^.^.^...^........................................................
.............................................................................................................................................
.......................................................^...^.^.......^.^.^.......^.^.^.......................................................
.............................................................................................................................................
......................................................^.^.^...^.^.....^.^...^.....^.^.^......................................................
.............................................................................................................................................
.....................................................^.^.^...^.^...^.^.^.^.^...^.^.....^.....................................................
.............................................................................................................................................
....................................................^.^.^.^...^...^.^.^.^.^.^...........^....................................................
.............................................................................................................................................
...................................................^...^.^.^.^.^.^.^.....^.^.^.........^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.^...^.^..................................................
.............................................................................................................................................
.................................................^...^.^...^.^.^.....^.^.^.........^.....^.^.................................................
.............................................................................................................................................
................................................^.......^...^.^.^.^.....^.....^.^...^...^.^.^................................................
.............................................................................................................................................
...............................................^.^.^.^.^.^.....^.^.^.^...^.^.^...^.^.^.^.^...^...............................................
.............................................................................................................................................
..............................................^...^.....^.......^.^...^...^.^.....^.^...^...^.^..............................................
.............................................................................................................................................
.............................................^.^.^.^...^.^.^.....^.^...^.^.^...^.....^.^.^.....^.............................................
.............................................................................................................................................
............................................^.^.....^.^...^...^.^...^.^.^.....^.^.^.^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^...^.^.^...^...^.^.^.^.^...^.....^.^.........^.^.^.^.^...........................................
.............................................................................................................................................
..........................................^...^.^.^.^.......^.^.^...^...^...^.^.^.^.....^.^.^...^.^..........................................
.............................................................................................................................................
.........................................^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^.^.^.^...^.........................................
.............................................................................................................................................
........................................^.^.^.^.^...^...^...^...^.^.....^.......^.^...^...^.^.^.^.^.^........................................
.............................................................................................................................................
.......................................^...^...^...^.^...^.^...^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.......................................
.............................................................................................................................................
......................................^.^.^.....^.^.^...^.^.^.^...^.^.^.^...^...^.^.^.^.........^.^.^.^......................................
.............................................................................................................................................
.....................................^.^...^...^.^.^...^.^.^.^.....^.^...^.^.^.^.^.......^...^.^...^.^.^.....................................
.............................................................................................................................................
....................................^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^...^.^.^...^.^.^.^.^...^.^.^.^.^.^....................................
.............................................................................................................................................
...................................^.....^.^.......^...^.^.....^.^.^.^...^.....^.^.^.^.^...^...^...^...^.^...................................
.............................................................................................................................................
..................................^.^.^.^...^.^.....^.^...^.^.......^...^...^.....^.^.^.^.....^.^.^.^.^.^.^..................................
.............................................................................................................................................
.................................^...^.....^.^.^.^.^.^.....^...^...^.^...^.^.^...^.^.^.^.^.^.^.^.^.....^...^.................................
.............................................................................................................................................
................................^.^.......^.^.....^.^.^.....^.^...^...^.^.^.^...^.....^...^.^.^.^...^.^...^.^................................
.............................................................................................................................................
...............................^.^...^.^...^.......^...^.^.^.^.^.^.^.^.^...^.^.^.^.........^.^.^...^.^.^.^.^.^...............................
.............................................................................................................................................
..............................^.^.^.^...^.^...^.^.......^.....^.^.^.^.^.^...^.......^.^.^.^.^.^.^.^.^.......^.^..............................
.............................................................................................................................................
.............................^...^.....^.^.^.^.....^.^.^...^.^.^...^.......^.^.^.^.^.^.^.......^...^...^.^...^.^.............................
.............................................................................................................................................
............................^.^...^.^...^.^.^.^.^...^.^.......^.^.^.^.........^.^.^.........^.^.....^.^.^.^.^.^.^............................
.............................................................................................................................................
...........................^.^.^.^.^.^.^.^...^.^...^.^...^.^.^.....^.^.......^.....^.^.^.^...^.^.^.^.^.^.^...^.^.^...........................
.............................................................................................................................................
..........................^.^...^...^.^.^...^...^...^...^.....^.^...^.^.^.^.^...^.^...^.^.^.....^.^...^.^...^.^.^.^..........................
.............................................................................................................................................
.........................^.^.^.^.^.^.^.^.^.^.^.....^.^.......^...^.............^.^.^.^.^.......^.^.^.^.^.^.^.^...^.^.........................
.............................................................................................................................................
........................^.^.^.^...^...^.^.^.^.^.^.^.^.^.....^.^.........^.^.^.^.^.^.^.^.....^...^...^.^.^.^.^.^.^.^.^........................
.............................................................................................................................................
.......................^.^...^.^.....^.^.^...^...^...^.^...^.^.^.^.^.^.^.......^.^.^...^.^.^.....^.^...^...^.........^.......................
.............................................................................................................................................
......................^...^.^...^.....^...^.^.^.......^.^.^.^.^...^.^.^.^.^.^.^...^...^.........^.^.^...^.^...^.^.^...^......................
.............................................................................................................................................
.....................^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.....^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....................
.............................................................................................................................................
....................^.^.^.^...^.^.^.........^.^...^.^...^.^...^.^.^.....^.^.^.^.....^...^.^...^.^.^.....^...^.^.^.^.^.^.^....................
.............................................................................................................................................
...................^.^.^...^...^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.........^...................
.............................................................................................................................................
..................^.^.^.^...^.....^...^...^.^.^.^.....^.^...^.^.^.^.^.^.^.^.^.......^.^.........^.....^.^.^.^.^.....^.^.^.^..................
.............................................................................................................................................
.................^.^.....^.....^.^.^.^...^...^.^.^.^...^.......^.^...^.^...^.^...^.........^...^.^.^.....^...^...^.^.....^.^.................
.............................................................................................................................................
................^.^...^.^.....^.^.^.^.^.^...^.^...^...^.......^.........^.^.^.^.^.^...........^...^.^.^.^.^.^...^...^.^.^...^................
.............................................................................................................................................
...............^.....^...^.^.^.........^.^.^.^.^.^.^.^...^.^.^...^...^.^...^.^.....^.^.....^...^.....^...^.^.....^.^.^.^...^.^...............
.............................................................................................................................................
..............^.^...^.^.^...^.......^.^.^.^...^...^.....^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.^...^.^.^.^.^...^.^.^.^.^.....^...^..............
.............................................................................................................................................
.............^.^.^...^.^.^.^...^.^...^...^.^.^.^.....^...^.^.^.^.........^.^...^.^.^.........^...^...^...^.^.^.^.^.^.^.......^.^.............
.............................................................................................................................................
............^.^.^.^.^...^.^.^...^...^...^.^.^.^.^...^.^.^.^.^...^...^.....^.^.^.^.^...^...^...^.......^...^.^.^...^.^.^.^...^.^.^............
.............................................................................................................................................
...........^...^.....^...^.^.^.^.^.^.^.^.......^.......^...^.^.^.^.^...^.^...^.....^.^.......^.^...^.....^...^.^...^...^.....^.^.^...........
.............................................................................................................................................
..........^.^...^.^.^...^.............^.^.^.^.^.^.^...^.^.^.^.............^.^.^.^.^.^.^.^.......^.^.^.^...^.^.^.^.^...^.^.^.^.^...^..........
.............................................................................................................................................
.........^.....^...^.^.^.....^.^.^.^...^.^...^...^.^.^.^.^.^.^.....^.......^.^.^...^...^.^.^...^.^.^.....^.....^.^.^.^.^.....^.....^.........
.............................................................................................................................................
........^.^.^.^.^.^...^.....^.^...^.^.^.^.^.^.^.^.....^.^.^.^.^.......^...^...^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.....^.^.^.....^...^........
.............................................................................................................................................
.......^.^.....^...^.....^.^.....^...^.^.....^...^.^...^.^.^.^.^.....^...^.^.^.^.....^.^...^.^...^.^.^.^...^.^.^.....^...^...^...^...^.......
.............................................................................................................................................
......^.^...^.^.^.....^.....^...^...^...^.^...^.^.^.^.............^...^.^...^.....^...^.^.^...^.^.^...^.^.^...^...^.^.^.^.......^.....^......
.............................................................................................................................................
.....^.^.^.^...^.^.^.^.^.^...^...^.^.^.^.....^.^.^.^.^.....^.^.^.^...^.^.^...^.^.^...^...^.....^.^.^.^.......^...^.^.^...^.^...^.^.^.^.^.....
.............................................................................................................................................
....^.^.^.^...^.^.^.^...^.^...^.^.^.^.......^.^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.....^.^.^...^.^.^.^.^.^.^...^.....^.^.....^.^.^.^.^.^.^....
.............................................................................................................................................
...^.^.^.^.^.......^.^.^.^.^...^...^.^...^.^.......^.^...^.......^...........^.^.^.....^...^.^.^.^...^.........^.^...^...^.^.^.....^.^.^.^...
.............................................................................................................................................
..^.......^.^.^.^.^...^.^...^.^.^.^.^.^.....^.^.......^.^...^.^.^.^.^...^.^.^.^.....^.^.^.....^...^.^.....^...^.^.^.^.^.^.^...^.....^.^...^..
.............................................................................................................................................
.^.^.........^.^.^.^...^...^.^...^.^...^.^...^.^.^...^.^.......^...^.....^.^.^.^.^...^.^.^.^.^.^...^.^...^.^...^.^.^.^.^...^.^.^.^.^...^.^.^.
.............................................................................................................................................";
#endregion

static List<string> SplitInputIntoLines(string input)
{
    return input.Split("\n").ToList();
}

// Aufgabe 1
static int CalculateNumberOfTachynBeamSplits(List<string> input)



{
    int total =0;
    HashSet<int> PositionsOfTachyonBeams = new HashSet<int>();
    for (int i = 0; i<input[0].Length;i++)
    {
        if (input[0][i] == 'S')
        {
            PositionsOfTachyonBeams.Add(i);
        }
    }

    foreach (string LineOfDividers in input.Skip(1))
    {
        for (int i = 0; i < LineOfDividers.Length;i++)
        {
            if (LineOfDividers[i] == '^' && PositionsOfTachyonBeams.Contains(i))
            {
                total++;
                PositionsOfTachyonBeams.Remove(i);
                if (i-1 >-1)
                {
                    PositionsOfTachyonBeams.Add(i-1);
                }
                if (i+1 < LineOfDividers.Length)
                {
                    PositionsOfTachyonBeams.Add(i+1);
                }                
            }
        }
    }

    return total;
}

int result = CalculateNumberOfTachynBeamSplits(SplitInputIntoLines(PuzzleInput));
System.Console.WriteLine($"The Tachyon Beam in PArt1 gets divided {result} times ");

 
// Aufgabe 2
long result2 = CalculateNumberOfFuturesNecessaryForTachyonToTravelAllPaths(SplitInputIntoLines(PuzzleInput));
System.Console.WriteLine($"The Tachyonbeam needs {result2} futures to travel all paths");
Console.ReadKey();

static long CalculateNumberOfFuturesNecessaryForTachyonToTravelAllPaths(List<string> input)
{
    Dictionary<int,long> FuturesPerLine = new Dictionary<int,long>();
    int StartingPosition = input[0].IndexOf('S');
    
    FuturesPerLine[StartingPosition] = 1;
    long totalSplits =0;
    
        for (int row =1 ; row < input.Count; row++)
    {
        var nextPositions = new Dictionary<int,long>();
        foreach (var kvp in FuturesPerLine)
        {
            int column = kvp.Key;
            long count = kvp.Value;

            if(column < 0 || column >= input[0].Length) 
            {
                continue;
            }

            char cell = input[row][column];

            if (cell =='^')
            {
                totalSplits += count;

                int left = column - 1;
                int right = column + 1;

                if (left >= 0)
                {
                    if (nextPositions.ContainsKey(left))
                        nextPositions[left] += count;
                    else
                        nextPositions[left] = count;
                }

                if (right < input[0].Length)
                {
                    if (nextPositions.ContainsKey(right))
                        nextPositions[right] += count;
                    else
                        nextPositions[right] = count;
                }
            }
            else
            {
                // Just continue straight down
                if (nextPositions.ContainsKey(column))
                    nextPositions[column] += count;
                else
                    nextPositions[column] = count;
            }
        }

        FuturesPerLine = nextPositions;
    }

    long totalTimelines = 1 + totalSplits; // start with 1, each split adds +1
    return totalTimelines;
}

